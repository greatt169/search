(function(){BX.namespace("BX.Sender.Message");if(BX.Sender.Message.Editor){return}var t=BX.Sender.Helper;function e(){this.context=null;this.editor=null}e.prototype.classNameMoreActive="sender-more-active";e.prototype.init=function(e){this.context=BX(e.containerId);this.actionUri=e.actionUri;this.mess=e.mess;this.fieldPrefix=e.fieldPrefix;this.messageCode=e.messageCode;this.templateType=e.templateType;this.templateId=e.templateId;this.moreButton=t.getNode("more-btn",this.context);this.moreFields=t.getNode("more-fields",this.context);if(this.moreButton&&this.moreFields){BX.bind(this.moreButton,"click",this.onMoreClick.bind(this))}this.configuration=new i(this);this.ajaxAction=new BX.AjaxAction(this.actionUri);t.hint.init(this.context);this.bindNodes();this.initFields()};e.prototype.initFields=function(){var e=this.context.querySelectorAll("[data-bx-field]");e=BX.convert.nodeListToArray(e);e.forEach(function(e){var i=e.getAttribute("data-bx-field");var n=e.querySelector('[name="'+i+'"]');t.tag.init(e,n)},this)};e.prototype.onMoreClick=function(){t.display.toggle(this.moreFields);BX.toggleClass(this.moreButton,this.classNameMoreActive)};e.prototype.setAdaptedInstance=function(t){this.editor=t};e.prototype.initTester=function(){var t=BX.Sender.Message.Tester;if(!t){return}BX.addCustomEvent(t,t.eventNameSend,this.onTestSend.bind(this))};e.prototype.bindNodes=function(){setTimeout(this.initTester.bind(this),200);if(BX.Sender.Template&&BX.Sender.Template.Selector){var t=BX.Sender.Template.Selector;BX.addCustomEvent(t,t.events.templateSelect,this.onTemplateSelect.bind(this))}};e.prototype.onTemplateSelect=function(t){this.setTemplate(t)};e.prototype.setTemplate=function(t){this.templateType=t.type;this.templateId=t.code;var e={};(t.messageFields||{}).reduce(function(t,e){if(!e.onDemand){t[e.code]=e.value}return t},e);this.configuration.set(e)};e.prototype.onTestSend=function(t){t.data=this.getConfiguration()};e.prototype.getConfiguration=function(){return this.configuration.get()};function i(t){this.manager=t}i.prototype={getInputs:function(){var t=this.manager.context.querySelectorAll("select, textarea, "+'input[type="text"], '+'input[type="hidden"], '+'input[type="radio"]:checked, '+'input[type="checkbox"]:checked');t=BX.convert.nodeListToArray(t);return t.filter(function(t){return!!this.getInputName(t)},this)},getInputName:function(t){var e=t.name;if(e.indexOf(this.manager.fieldPrefix)!==0){return""}return e.substring(this.manager.fieldPrefix.length)},set:function(t){this.getInputs().forEach(function(e){var i=this.getInputName(e);if(t[i]){e.value=t[i];BX.fireEvent(e,"change")}},this)},get:function(){var t={};this.getInputs().forEach(function(e){var i=this.getInputName(e);if(!e.value){return}if(t[i]){if(!BX.type.isArray(t[i])){t[i]=[t[i]]}t[i].push(e.value)}else{t[i]=e.value}},this);t.TEMPLATE_TYPE=this.manager.templateType;t.TEMPLATE_ID=this.manager.templateId;return t}};BX.Sender.Message.Editor=new e})(window);