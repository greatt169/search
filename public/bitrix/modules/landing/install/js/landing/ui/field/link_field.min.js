(function(){"use strict";BX.namespace("BX.Landing.UI.Field");var e=BX.Landing.Utils.trim;var t=BX.Landing.Utils.clone;var i=BX.Landing.Utils.isPlainObject;var n=BX.Landing.Utils.decodeDataValue;var a=BX.Landing.Utils.fireCustomEvent;var s=BX.Landing.Utils.htmlToElement;var d=BX.Landing.Utils.style;BX.Landing.UI.Field.Link=function(n){BX.Landing.UI.Field.BaseField.apply(this,arguments);this.options=n.options||{};BX.remove(this.input);this.onValueChangeHandler=n.onValueChange?n.onValueChange:function(){};this.content=i(this.content)?this.content:{};this.content=t(this.content);this.content.text=e(this.content.text);this.content.href=e(this.content.href);this.content.target=e(this.content.target);this.input=new BX.Landing.UI.Field.Text({placeholder:BX.message("FIELD_LINK_TEXT_LABEL"),selector:this.selector,content:this.content.text,textOnly:true,onValueChange:function(){this.onValueChangeHandler(this);a(this,"BX.Landing.UI.Field:change",[this.getValue()])}.bind(this)});this.input.adjustTags();this.hrefInput=new BX.Landing.UI.Field.LinkURL({title:BX.message("FIELD_LINK_HREF_LABEL"),placeholder:BX.message("FIELD_LINK_HREF_PLACEHOLDER"),selector:this.selector,content:this.content.href,onInput:this.onHrefInput.bind(this),textOnly:true,options:this.options,disallowType:n.disallowType,disableBlocks:n.disableBlocks,disableCustomURL:n.disableCustomURL,allowedTypes:n.allowedTypes,onValueChange:function(){this.onValueChangeHandler(this);this.noHrefValueChange();a(this,"BX.Landing.UI.Field:change",[this.getValue()])}.bind(this)});this.targetInput=new BX.Landing.UI.Field.DropdownInline({title:BX.message("FIELD_LINK_TARGET_LABEL"),selector:this.selector,className:"landing-ui-field-dropdown-inline",content:this.content.target,items:{_self:BX.message("FIELD_LINK_TARGET_SELF"),_blank:BX.message("FIELD_LINK_TARGET_BLANK"),_popup:BX.message("FIELD_LINK_TARGET_POPUP")},onValueChange:function(){this.onValueChangeHandler(this);a(this,"BX.Landing.UI.Field:change",[this.getValue()])}.bind(this)});this.mediaButton=new BX.Landing.UI.Button.BaseButton(this.selector+"_media",{html:'<span class="fa fa-bolt"></span>&nbsp;'+BX.message("LANDING_CONTENT_URL_MEDIA_BUTTON"),className:"landing-ui-field-link-media",onClick:this.onMediaClick.bind(this)});this.mediaLayout=BX.create("div",{props:{className:"landing-ui-field-link-media-layout"}});this.mediaHelpButton=new BX.Landing.UI.Button.BaseButton(this.selector+"_media_qa",{html:'<span class="fa fa-question-circle"></span>&nbsp;',className:"landing-ui-field-link-media-help"});this.mediaHelpButton.layout.addEventListener("mouseover",this.onMediaHelpButtonMouseover.bind(this));this.mediaHelpButton.layout.addEventListener("mouseout",this.onMediaHelpButtonMouseout.bind(this));if(this.containsImage()||this.containsHtml()){this.input.layout.hidden=true;this.header.hidden=true;this.hrefInput.header.innerHTML=this.header.innerHTML}this.wrapper=BX.Landing.UI.Field.Link.createWrapper();this.left=BX.Landing.UI.Field.Link.createLeft();this.center=BX.Landing.UI.Field.Link.createCenter();this.right=BX.Landing.UI.Field.Link.createRight();this.left.appendChild(this.input.layout);this.center.appendChild(this.hrefInput.layout);this.right.appendChild(this.targetInput.layout);this.right.appendChild(this.mediaButton.layout);this.right.appendChild(this.mediaHelpButton.layout);this.wrapper.appendChild(this.left);this.wrapper.appendChild(this.center);this.wrapper.appendChild(this.right);this.layout.appendChild(this.wrapper);this.layout.appendChild(this.mediaLayout);this.layout.classList.add("landing-ui-field-link");this.adjustVideo()};BX.Landing.UI.Field.Link.createWrapper=function(){return BX.create("div",{props:{className:"landing-ui-field-link-wrapper"}})};BX.Landing.UI.Field.Link.createCenter=function(){return BX.create("div",{props:{className:"landing-ui-field-link-center"}})};BX.Landing.UI.Field.Link.createLeft=function(){return BX.create("div",{props:{className:"landing-ui-field-link-left"}})};BX.Landing.UI.Field.Link.createRight=function(){return BX.create("div",{props:{className:"landing-ui-field-link-right"}})};BX.Landing.UI.Field.Link.prototype={constructor:BX.Landing.UI.Field.Link,__proto__:BX.Landing.UI.Field.BaseField.prototype,superClass:BX.Landing.UI.Field.BaseField,noHrefValueChange:function(){},isChanged:function(){return JSON.stringify(this.content)!==JSON.stringify(this.getValue())},containsImage:function(){return!!BX.create("div",{html:this.content.text}).querySelector("img")},containsHtml:function(){var e=s(this.content.text);return!!e&&!e.matches("br")},getValue:function(){var t={text:n(e(this.input.getValue())),href:e(this.hrefInput.getValue()),target:e(this.targetInput.getValue())};if(this.isAvailableMedia()&&this.isEnabledMedia()){t.attrs={"data-url":e(this.mediaService.getEmbedURL())}}if(this.hrefInput.getDynamic()){if(!i(t.attrs)){t.attrs={}}if(this.hrefInput.input.firstElementChild){t.attrs["data-url"]=this.hrefInput.input.firstElementChild.getAttribute("data-url")}t.attrs["data-dynamic"]=this.hrefInput.getDynamic()}return t},setValue:function(e){if(i(e)){this.input.setValue(e.text);this.hrefInput.setValue(e.href);this.targetInput.setValue(e.target)}},reset:function(){this.setValue({text:"",href:"",target:"_self"})},enableMedia:function(){this.mediaButton.enable();this.targetInput.disable();this.targetInput.closePopup();this.targetInput.setValue("_popup");this.showMediaPreview()},disableMedia:function(){this.mediaButton.disable();this.targetInput.enable();this.targetInput.closePopup();this.targetInput.setValue(this.content.target);this.hideMediaPreview();this.hideMediaSettings()},isEnabledMedia:function(){return this.mediaButton.isEnabled()},showMediaSettings:function(){if(this.isAvailableMedia()){this.hideMediaSettings();this.mediaSettings=this.mediaService.getSettingsForm();if(this.mediaSettings){this.mediaLayout.appendChild(this.mediaSettings.layout)}}},hideMediaSettings:function(){if(this.mediaSettings){BX.remove(this.mediaSettings.layout)}},isAvailableMedia:function(){var e=new BX.Landing.MediaService.Factory;return!!e.create(this.hrefInput.getValue())},onMediaClick:function(){if(this.isAvailableMedia()){if(!this.isEnabledMedia()){this.enableMedia()}else{this.disableMedia()}}},onMediaHelpButtonMouseover:function(e){if(!this.helpPopup){this.helpPopup=new BX.PopupWindow(this.selector+"_help",this.mediaHelpButton.layout,{content:BX.create("div",{props:{className:"landing-ui-field-link-media-help-popup-content"},children:[BX.create("div",{props:{className:"landing-ui-field-link-media-help-popup-content-title"},html:BX.message("LANDING_CONTENT_URL_MEDIA_HELP_TITLE")}),BX.create("div",{props:{className:"landing-ui-field-link-media-help-popup-content-content"},html:BX.message("LANDING_CONTENT_URL_MEDIA_HELP")})]}),angle:{offset:32}});this.helpPopup.popupContainer.classList.add("landing-ui-field-link-media-help-popup")}this.helpPopupTimeout=setTimeout(function(){this.helpPopup.show();BX.Landing.Utils.Show(this.helpPopup.popupContainer)}.bind(this),100)},onMediaHelpButtonMouseout:function(e){if(this.helpPopup){BX.Landing.Utils.Hide(this.helpPopup.popupContainer)}clearTimeout(this.helpPopupTimeout)},onVideoPreviewClick:function(){$.fancybox.open({src:this.mediaService.getEmbedURL(),type:"iframe"},{iframe:{scrolling:"auto"}})},showMediaPreview:function(){var e=new BX.Landing.UI.Card.Loader;this.video=e.layout;this.mediaLayout.appendChild(this.video);e.show();this.mediaService.getURLPreviewElement().then(function(e){BX.remove(this.video);this.video=e;this.video.title=BX.message("LANDING_CONTENT_URL_PREVIEW_TITLE");this.mediaLayout.appendChild(this.video);this.video.addEventListener("click",this.onVideoPreviewClick.bind(this));this.showMediaSettings()}.bind(this),function(){this.hideMediaSettings();BX.remove(this.video)}.bind(this))},hideMediaPreview:function(){if(this.video){BX.remove(this.video)}},adjustVideo:function(){var e="attrs"in this.content&&"data-url"in this.content.attrs?this.content.attrs["data-url"]:"";var t=new BX.Landing.MediaService.Factory;this.mediaService=t.create(this.hrefInput.getValue(),BX.Landing.Utils.getQueryParams(e));if(this.mediaService){this.mediaService.url=this.hrefInput.getValue();this.disableMedia();if(this.isAvailableMedia()){this.enableMedia()}}else{this.disableMedia()}},onHrefInput:function(){this.adjustVideo()}}})();