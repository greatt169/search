(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.InlineEditor=function(t,e){this.parent=null;this.types=null;this.init(t,e)};BX.Grid.InlineEditor.prototype={init:function(parent,types){this.parent=parent;try{this.types=eval(types)}catch(t){this.types=null}},createContainer:function(){return BX.create("div",{props:{className:this.parent.settings.get("classEditorContainer")}})},createTextarea:function(t,e){var i=BX.create("textarea",{props:{className:[this.parent.settings.get("classEditor"),this.parent.settings.get("classEditorTextarea")].join(" ")},attrs:{name:t.NAME,style:"height:"+e+"px"},html:t.VALUE});return i},createInput:function(t){var e=this.parent.settings.get("classEditorText");var i={value:t.VALUE!==undefined&&t.VALUE!==null?BX.util.htmlspecialcharsback(t.VALUE):"",name:t.NAME!==undefined&&t.NAME!==null?t.NAME:""};if(t.TYPE===this.types.CHECKBOX){e=this.parent.settings.get("classEditorCheckbox");i.type="checkbox";i.checked=i.value=="Y"}if(t.TYPE===this.types.DATE){e=[e,this.parent.settings.get("classEditorDate")].join(" ")}if(t.TYPE===this.types.NUMBER){e=[e,this.parent.settings.get("classEditorNumber")].join(" ");i.type="number"}if(t.TYPE===this.types.RANGE){e=[e,this.parent.settings.get("classEditorRange")].join(" ");i.type="range";if(BX.type.isPlainObject(t.DATA)){i.min=t.DATA.MIN||"0";i.max=t.DATA.MAX||99999;i.step=t.DATA.STEP||""}}e=[this.parent.settings.get("classEditor"),e].join(" ");return BX.create("input",{props:{className:e,id:t.NAME+"_control"},attrs:i})},createCustom:function(t){var e=this.parent.settings.get("classEditorCustom");e=[this.parent.settings.get("classEditor"),e].join(" ");var i=BX.create("div",{props:{className:e},attrs:{"data-name":t.NAME},html:t.HTML});i.querySelectorAll("input, select, checkbox, textarea").forEach(function(e){switch(e.tagName){case"SELECT":e.value="";if(e.multiple){e.querySelectorAll("option").forEach(function(e){e.selected=false;if(Array.isArray(t.VALUE)){if(BX.util.in_array(e.value,t.VALUE)){e.selected=true}}else{if(e.value===t.VALUE){e.selected=true}}})}else{e.value=t.VALUE}break;case"INPUT":switch(e.type.toUpperCase()){case"CHECKBOX":e.checked=t.VALUE==="1"||t.VALUE==="Y";break;case"HIDDEN":break;default:e.value=t.VALUE}break;default:e.value=t.VALUE}});return i},createOutput:function(t){return BX.create("output",{props:{className:this.parent.settings.get("classEditorOutput")||""},attrs:{for:t.NAME+"_control"},text:t.VALUE||""})},getDropdownValueItemByValue:function(t,e){var i=t.filter(function(t){return t.VALUE===e});return i.length>0?i[0]:t[0]},createDropdown:function(t){var e=this.getDropdownValueItemByValue(t.DATA.ITEMS,t.VALUE);return BX.create("div",{props:{className:[this.parent.settings.get("classEditor"),"main-dropdown main-grid-editor-dropdown"].join(" "),id:t.NAME+"_control"},attrs:{name:t.NAME,"data-items":JSON.stringify(t.DATA.ITEMS),"data-value":e.VALUE},children:[BX.create("span",{props:{className:"main-dropdown-inner"},html:e.NAME})]})},validateEditObject:function(t){return BX.type.isPlainObject(t)&&"TYPE"in t&&"NAME"in t&&"VALUE"in t&&(!("items"in t)||BX.type.isArray(t.items)&&t.items.length)},initCalendar:function(t){BX.calendar({node:t.target,field:t.target})},bindOnRangeChange:function(t,e){function i(t,e){BX.html(e,t.value);var i=parseFloat(t.value);var n=parseFloat(t.getAttribute("max"));var a=parseFloat(t.getAttribute("min"));var s=16;var r=n-a;var o=(i-a)/r*100;var c=Math.round(s*o/100)-s/2;e.style.left=o+"%";e.style.marginLeft=-c+"px"}setTimeout(function(){i(t,e)},0);BX.bind(t,"input",function(){i(t,e)})},getEditor:function(t,e){var i,n;var a=this.createContainer();if(this.validateEditObject(t)){t.VALUE=t.VALUE===null?"":t.VALUE;switch(t.TYPE){case this.types.TEXT:{i=this.createInput(t);BX.bind(i,"click",function(t){t.stopPropagation()});BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.DATE:{i=this.createInput(t);BX.bind(i,"click",this.initCalendar);BX.bind(i,"click",function(t){t.stopPropagation()});BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.NUMBER:{i=this.createInput(t);BX.bind(i,"click",function(t){t.stopPropagation()});BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.RANGE:{i=this.createInput(t);n=this.createOutput(t);this.bindOnRangeChange(i,n);BX.bind(i,"click",function(t){t.stopPropagation()});BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.CHECKBOX:{i=this.createInput(t);BX.bind(i,"click",function(t){t.stopPropagation()});BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.TEXTAREA:{i=this.createTextarea(t,e);BX.bind(i,"click",function(t){t.stopPropagation()});BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.DROPDOWN:{i=this.createDropdown(t);break}case this.types.CUSTOM:{i=this.createCustom(t);BX.bind(i,"click",function(t){t.stopPropagation()});break}default:{break}}}if(BX.type.isDomNode(n)){a.appendChild(n)}if(BX.type.isDomNode(i)){a.appendChild(i)}return a},_onControlKeydown:function(t){if(t.code==="Enter"){t.stopPropagation();t.preventDefault();var e=BX.Grid.Utils.getBySelector(this.parent.getContainer(),"#grid_save_button > button",true);if(e){BX.fireEvent(e,"click")}}}}})();