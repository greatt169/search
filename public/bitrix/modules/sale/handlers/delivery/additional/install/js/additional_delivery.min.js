BX.namespace("BX.Sale.Handler.Delivery.Additional");BX.Sale.Handler.Delivery.Additional={ajaxUrl:"/bitrix/tools/sale/delivery_additional.php",interruptFlag:false,requestFlag:false,sendRequest:function(e){if(!e)return;var a=e,r=e.callback?e.callback:null,s=this;if(a.callback)delete a.callback;a.sessid=BX.bitrix_sessid();this.requestFlag=true;BX.ajax({timeout:120,method:"POST",dataType:"json",url:this.ajaxUrl,data:a,onsuccess:function(e){s.requestFlag=false;if(s.interruptFlag){s.closeProgressDialog();return}if(e){if(r&&typeof r=="function")r.call(null,e)}else{s.pb.showError(BX.message("SALE_DLVRS_ADD_LOC_COMP_AJAX_ERROR"))}if(e&&e.ERROR){s.pb.showError(e.ERROR)}},onfailure:function(e){s.requestFlag=false;s.pb.showError("ajax onfailure");s.pb.showError("status: "+e);if(s.interruptFlag)s.closeProgressDialog()}})},startLocationsCompare:function(){this.showProgressDialog();this.sendRequest({action:"locations_compare",callback:BX.Sale.Handler.Delivery.Additional.processLocationsCompareAnswer})},processLocationsCompareAnswer:function(e){if(!e||!e.stage||!e.action){BX.Sale.Handler.Delivery.Additional.pb.showError(BX.message("SALE_DLVRS_ADD_LOC_COMP_AJAX_ERROR"));return}if(e.message)BX.Sale.Handler.Delivery.Additional.pb.showMessage(e.message);if(e.progress)BX.Sale.Handler.Delivery.Additional.pb.Update(e.progress);if(e.error){BX.Sale.Handler.Delivery.Additional.pb.showError(e.error);return}if(e.stage&&e.stage=="finish"){BX("progress_cancel").value=BX.message("SALE_DLVRS_ADD_LOC_COMP_CLOSE");return}BX.Sale.Handler.Delivery.Additional.sendRequest({action:e.action,stage:e.stage,step:e.step?e.step:"",progress:e.progress?e.progress:0,callback:BX.Sale.Handler.Delivery.Additional.processLocationsCompareAnswer})},closeProgressDialog:function(){if(!this.interruptFlag)this.interruptFlag=true;if(this.requestFlag)return;BX.WindowManager.Get().Close();if(this.interruptFlag)this.interruptFlag=false},showProgressDialog:function(){var e=new BX.CDialog({content:BX.Sale.Handler.Delivery.Additional.pb.getNode(),width:530,height:200,draggable:true,resizable:true,title:BX.message("SALE_DLVRS_ADD_LOC_COMP_TITLE"),buttons:[{title:BX.message("JS_CORE_WINDOW_CANCEL"),id:"progress_cancel",name:"progress_cancel",action:function(){window.location.reload();BX.Sale.Handler.Delivery.Additional.closeProgressDialog()}}]});BX.Sale.Handler.Delivery.Additional.pb.Init();e.adjustSizeEx();e.Show();BX.Sale.Handler.Delivery.Additional.pb.showError("");BX.Sale.Handler.Delivery.Additional.pb.showMessage(BX.message("SALE_DLVRS_ADD_LOC_COMP_PREPARE"))},pb:{width:0,obContainer:false,obIndicator:false,obIndicator2:false,Init:function(){this.obContainer=BX("instal-load-block");this.obIndicator=BX("instal-progress-bar-inner-text");this.obIndicator2=BX("instal-progress-bar-span");this.obIndicator3=BX("instal-progress-bar-inner");this.obContainer.style.display="";this.width=this.obContainer.clientWidth||this.obContainer.offsetWidth},Update:function(e){this.obIndicator.innerHTML=this.obIndicator3.style.width=e+"%";this.obIndicator2.innerHTML=e+"%"},showError:function(e){var a=BX("instal-load-error");a.innerHTML=e;a.style.display=!!e?"":"none";BX.WindowManager.Get().adjustSizeEx()},showMessage:function(e,a){var r=BX("instal-load-label"),s=r.innerHTML;r.innerHTML=(a?s+"<br>":"")+e;r.style.display=!!e?"":"none";BX.WindowManager.Get().adjustSizeEx()},getNode:function(){var e=BX("instal-load-block");if(!e){e=BX.create("div",{props:{className:"instal-load-block",id:"instal-load-block"},children:[BX.create("div",{props:{className:"instal-load-label",id:"instal-load-label"}}),BX.create("div",{props:{className:"instal-load-error",id:"instal-load-error"}}),BX.create("div",{props:{className:"instal-progress-bar-outer",id:"instal-progress-bar-outer"},style:{width:"500px"},children:[BX.create("div",{props:{className:"instal-progress-bar-alignment"},children:[BX.create("div",{props:{className:"instal-progress-bar-inner",id:"instal-progress-bar-inner"},style:{width:"0%"},children:[BX.create("div",{props:{className:"instal-progress-bar-inner-text",id:"instal-progress-bar-inner-text"},style:{width:"500px"},html:"0%"})]}),BX.create("div",{props:{className:"instal-progress-bar-span",id:"instal-progress-bar-span"},html:"0%"})]})]})]})}return e}}};
//# sourceMappingURL=additional_delivery.map.js