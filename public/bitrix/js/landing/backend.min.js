(function(){"use strict";BX.namespace("BX.Landing");var n=BX.Landing.Utils.isPlainObject;BX.Landing.Backend=function(){this.ajaxController="/bitrix/tools/landing/ajax.php"};BX.Landing.Backend.instance=null;BX.Landing.Backend.getInstance=function(){if(!BX.Landing.Backend.instance){BX.Landing.Backend.instance=new BX.Landing.Backend}return BX.Landing.Backend.instance};BX.Landing.Backend.prototype={action:function(n,i,a,t){t=BX.type.isPlainObject(t)?t:{};a=BX.type.isPlainObject(a)?a:{};BX.Landing.Utils.assign(a,{site_id:this.getSiteId()});var e={};e.sessid=BX.bitrix_sessid();e.action=n.replace("Landing\\Block","Block");e.data=typeof i==="object"?i:{};e.data.lid=e.data.lid||BX.Landing.Main.getInstance().id;if("action"in t){e.action=t.action}if("block"in t){e.data.block=t.block}if("lid"in t){e.data.lid=t.lid}if("id"in t){e.data.id=t.id}var d=BX.util.add_url_param(this.ajaxController,BX.util.objectMerge({action:e.action},a));return new Promise(function(n,i){BX.ajax({method:"POST",dataType:"json",url:d,data:e,onsuccess:function(a){if(!!a&&a.type==="error"){i(a)}else{n(a.result)}},onfailure:function(n){i(n)}})}).catch(function(n){n.action=e.action;BX.Landing.ErrorManager.getInstance().add(n);return Promise.reject()})},batch:function(n,i,a){a=BX.type.isPlainObject(a)?a:{};BX.Landing.Utils.assign(a,{site_id:i.siteId||this.getSiteId()});var t={};t.sessid=BX.bitrix_sessid();t.action=n.replace("Landing\\Block","Block");t.data={};t.batch=typeof i==="object"?i:{};t.data.lid=t.data.lid||BX.Landing.Main.getInstance().id;var e=BX.util.add_url_param(this.ajaxController,BX.util.objectMerge({action:t.action},a));return new Promise(function(n,i){BX.ajax({method:"POST",dataType:"json",url:e,data:t,onsuccess:function(a){if(!!a&&a.type==="error"){i(a)}else{n(a)}},onfailure:function(n){i(n)}})}).catch(function(n){n.action=t.action;BX.Landing.ErrorManager.getInstance().add(n);return Promise.reject()})},getSiteId:function(){var n;try{n=BX.Landing.Main.getInstance().options.site_id}catch(i){n=-1}return n},uploadImage:function(i,a,t,e){e=n(e)?e:{};var d={};d.sessid=BX.bitrix_sessid();d.action="action"in e?e.action:"Utils::uploadFile";d.picture=a;d.data={};d.data.params=typeof t==="object"?t:{};if("block"in e){d.data.block=e.block}if("lid"in e){d.data.lid=e.lid}if("id"in e){d.data.id=e.id}var c=BX.util.add_url_param(this.ajaxController,{action:d.action,site_id:this.getSiteId()});return new Promise(function(n,a){BX.ajax.submitAjax(i,{url:c,method:"POST",dataType:"json",data:d,onsuccess:function(i){n(i.result)},onfailure:function(n){a(n)}})}.bind(this))}}})();